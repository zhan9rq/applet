(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/create/order"],{"0e61":function(e,t,n){"use strict";(function(e){n("3029"),n("921b");i(n("66fd"));var t=i(n("eec4"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"17b9":function(e,t,n){},"2ca0":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=u(n("a34a")),r=n("72a0"),o=u(n("9e6c")),a=n("2f62");function u(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,i,r,o,a){try{var u=e[o](a),c=u.value}catch(s){return void n(s)}u.done?t(c):Promise.resolve(c).then(i,r)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){c(o,i,r,a,u,"next",e)}function u(e){c(o,i,r,a,u,"throw",e)}a(void 0)}))}}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){n.e("components/rf-picker/index").then(function(){return resolve(n("e091"))}.bind(null,n)).catch(n.oe)},h=function(){Promise.all([n.e("common/vendor"),n.e("components/rf-no-data/index")]).then(function(){return resolve(n("97c0"))}.bind(null,n)).catch(n.oe)},m={components:{rfPicker:f,rfNoData:h},data:function(){return{maskState:0,isFullPayment:0,desc:"",payType:1,orderDetail:{},pointExchangeType:[],loadingType:"more",pickerShippingType:[],btnLoading:!1,currentShippingType:{value:""},currentCompany:{},currentPickupPoint:{},cartIds:null,invoiceItem:{},addressData:{},couponItem:{},pointConfig:{},product:null,shippingMoney:0,isUsePoint:!1,isUsePointDisabled:!1,data:{},userInfo:{},use_point:0,invoiceContent:null,loading:!0,errorInfo:"",buyerMessage:"",promoCode:"",moneySymbol:this.moneySymbol,logo:this.$mSettingConfig.appLogo,singleSkuText:this.singleSkuText}},computed:{amountGoods:function(){return this.orderDetail.preview&&this.orderDetail.preview.product_money},discountAmount:function(){var e=this.floor((100-this.couponItem.discount)/100*this.amountGoods);return 2===parseInt(this.couponItem.type,10)?e:this.couponItem.money||0},realAmount:function(){var e=this.amountGoods-this.discountAmount+parseFloat(this.shippingMoney)-(this.isUsePoint?this.maxUsePointFee:0);return(parseFloat(this.invoiceAmount)+e>0?parseFloat(this.invoiceAmount)+e:0).toFixed(2)},invoiceAmount:function(){var e=this.amountGoods-this.discountAmount-(this.isUsePoint?this.maxUsePointFee:0);return this.invoiceItem.type?this.floor(this.orderDetail.invoice.order_invoice_tax/100*e):0},maxUsePoint:function(){return this.orderDetail.max_use_point>e.getStorageSync("userInfo").account.user_integral?e.getStorageSync("userInfo").account.user_integral:this.orderDetail.max_use_point},maxUsePointFee:function(){return this.maxUsePoint*this.pointConfig.convert_rate},givePoint:function(){return function(e){return this.couponItem.discount?Math.floor(this.couponItem.discount/100*e):e}}},filters:{time:function(e){return(0,o.default)(1e3*e).format("YY/MM/DD HH:mm")}},onShow:function(){this.addressData&&this.addressData.realname&&this.getOrderFreightFee()},onLoad:function(e){this.initData(e)},methods:l(l({},(0,a.mapMutations)(["setCartNum"])),{},{handleIsFullPayment:function(e){this.isFullPayment=e.detail.value},handleInvoiceChange:function(e){this.invoiceContent=e},navTo:function(e){this.$mRouter.push({route:e})},closeInvoice:function(){this.invoiceItem={}},clearCoupon:function(){this.couponItem={}},floor:function(e){return Math.floor(100*e)/100},handleIsUsePoint:function(){this.isUsePoint?(this.isUsePoint=!1,this.use_point=0):(this.isUsePoint=!0,this.use_point=this.maxUsePoint)},showSinglePicker:function(){this.$refs.shippingTypePicker.show()},showCompanyPicker:function(){this.$refs.companyTypePicker.show()},showPickupPointPicker:function(){this.$refs.pickupPointPicker.show()},onShippingConfirm:function(e){e.value=e.value[0],this.currentShippingType=e,"2"===this.currentShippingType.value.toString()?parseFloat(this.realAmount)>parseFloat(this.orderDetail.pickup_point_config.pickup_point_freight)?this.shippingMoney=0:this.shippingMoney=parseFloat(this.orderDetail.pickup_point_config.pickup_point_fee)||0:(this.currentCompany=this.orderDetail.company[0],this.getOrderFreightFee())},onCompanyConfirm:function(e){var t=this;return s(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.value=e.value[0],t.currentCompany=e,!t.orderDetail.is_full_mail){n.next=5;break}return t.shippingMoney=0,n.abrupt("return");case 5:t.getOrderFreightFee();case 6:case"end":return n.stop()}}),n)})))()},onPickupPointConfirm:function(e){var t=this;return s(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.value=e.value[0],t.currentPickupPoint=e,t.currentPickupPoint&&(t.shippingMoney=parseFloat(t.orderDetail.pickup_point_config.pickup_point_fee)||0);case 3:case"end":return n.stop()}}),n)})))()},getOrderFreightFee:function(){var e=this;return s(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={},e.addressData&&(n.address_id=e.addressData.id),e.currentCompany&&(n.company_id=e.currentCompany.value),t.next=5,e.$http.get("".concat(r.orderFreightFee),l(l({},n),e.data)).then((function(t){e.shippingMoney=t.data.shipping_money||0}));case 5:case"end":return t.stop()}}),t)})))()},initData:function(t){var n=this;return s(i.default.mark((function r(){return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n.promoCode=t.promo_code,i.next=3,JSON.parse(t.data);case 3:return n.data=i.sent,n.userInfo=e.getStorageSync("userInfo"),i.next=7,n.getOrderDetail();case 7:case"end":return i.stop()}}),r)})))()},getOrderDetail:function(){var e=this;return s(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("".concat(r.orderPreview),e.data).then((function(t){e.loading=!1,e.orderDetail=t.data,e.pointConfig=e.orderDetail.point_config,e.addressData=e.orderDetail.address,e.couponItem=e.orderDetail&&e.orderDetail.coupons[0]||{},e.orderDetail.company.forEach((function(e){e.label=e.title,e.value=e.id})),e.currentCompany=e.orderDetail.company[0],e.pointExchangeType=[],e.orderDetail.products.forEach((function(t){e.pointExchangeType.push(t.point_exchange_type)})),e.shippingMoney=t.data.preview.shipping_money,"1"===e.orderDetail.is_open_logistics&&e.pickerShippingType.push({label:"物流配送",value:1}),"1"===e.orderDetail.pickup_point_config.buyer_self_lifting?(e.orderDetail.pickup_point_config.list.forEach((function(e){e.label="".concat(e.contact||"无名"," - ").concat(e.name||"未知"," - ").concat(e.address||"未知"),e.value=e.id})),e.currentPickupPoint=e.orderDetail.pickup_point_config.list[0]||{},e.pickerShippingType.push({label:"买家自提",value:2})):e.orderDetail.pickup_point_config.list=[],e.pickerShippingType.length>0&&(e.currentShippingType=e.pickerShippingType[0])})).catch((function(t){e.loading=!1,e.errorInfo=t}));case 2:case"end":return t.stop()}}),t)})))()},toggleMask:function(e){var t=this;if(-1==="combination,wholesale,group_buy".indexOf(this.data.type)){var n="show"===e?10:300,i="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=i}),n)}else this.$mHelper.toast("套餐购买/拼团/团购下单不支持选择购物券")},numberChange:function(e){this.number=e.number},changePayType:function(e){this.payType=e},submit:function(){var t=this;return s(i.default.mark((function n(){var o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if("1"!==t.orderDetail.close_all_logistics){n.next=3;break}return t.$mHelper.toast("物流配送暂未开启，请联系客服"),n.abrupt("return");case 3:if(0!==t.pickerShippingType.length){n.next=6;break}return t.$mHelper.toast("请联系客服开启物流配送"),n.abrupt("return");case 6:if(o={},o.buyer_message=t.buyerMessage,t.promoCode&&(o.promo_code=t.promoCode),t.couponItem&&t.couponItem.id&&(o.coupon_id=t.couponItem.id),t.invoiceItem&&t.invoiceItem.id&&(o.invoice_id=t.invoiceItem.id,o.invoice_content=t.invoiceContent||t.orderDetail.invoice.list[0]),"1"!==t.currentShippingType.value.toString()){n.next=19;break}if(t.currentCompany&&t.currentCompany.value&&(o.company_id=t.currentCompany.value),!t.addressData||!t.addressData.id){n.next=17;break}o.address_id=t.addressData.id,n.next=19;break;case 17:return t.$mHelper.toast("请选择收货地址"),n.abrupt("return");case 19:return t.currentShippingType&&t.currentShippingType.value&&(o.shipping_type=t.currentShippingType.value,"2"===t.currentShippingType.value.toString()&&t.currentPickupPoint&&t.currentPickupPoint.value&&(o.pickup_id=t.currentPickupPoint.value)),t.use_point&&(o.use_point=t.use_point),t.btnLoading=!0,n.next=24,t.$http.post("".concat(r.orderCreate),l(l({},o),t.data)).then((function(n){var i={};i.order_id=parseInt(n.data.id,10),"cart"===t.data.type&&t.setCartItemCount(),1===parseInt(n.data.pay_status,10)?e.redirectTo({url:"/pages/user/money/success?type=".concat(t.data.type,"&id=").concat(n.data.wholesale_id)}):e.redirectTo({url:"/pages/user/money/pay?id=".concat(n.data.id,"&type=").concat(t.data.type)})})).catch((function(){t.btnLoading=!1}));case 24:case"end":return n.stop()}}),n)})))()},setCartItemCount:function(){var t=this;return s(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$http.get("".concat(r.cartItemCount)).then((function(n){parseInt(n.data,10)>0?t.setCartNum(n.data):(e.removeStorageSync("cartNum"),e.removeTabBarBadge({index:t.$mConstDataConfig.cartIndex}))}));case 2:case"end":return n.stop()}}),n)})))()},stopPrevent:function(){},selectCoupon:function(e){parseFloat(e.at_least)>parseFloat(this.amountGoods)?this.$mHelper.toast("不满足优惠券使用条件~"):(this.maskState=0,this.couponItem=e)}})};t.default=m}).call(this,n("543d")["default"])},"2ed9":function(e,t,n){"use strict";n.r(t);var i=n("2ca0"),r=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=r.a},5049:function(e,t,n){"use strict";var i=n("17b9"),r=n.n(i);r.a},a710:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var i={rfImage:function(){return Promise.all([n.e("common/vendor"),n.e("components/rf-image/rf-image")]).then(n.bind(null,"0e89"))},uniTag:function(){return n.e("components/uni-tag/uni-tag").then(n.bind(null,"c53c"))}},r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.orderDetail.products?parseInt(e.currentShippingType.value,10):null),i=e.orderDetail.products?parseInt(e.currentShippingType.value,10):null,r=e.orderDetail.products?e.__map(e.orderDetail.marketing_details,(function(t,n){var i=e.__get_orig(t),r=(t.discount_money>0||t.give_point>0)&&"give_point"===t.marketing_type?e.givePoint(t.give_point):null;return{$orig:i,m2:r}})):null,o=e.orderDetail.products&&e.invoiceItem.type?parseInt(e.invoiceItem.type,10):null,a=parseFloat(e.amountGoods),u=e.__map(e.orderDetail.coupons,(function(t,n){var i=e.__get_orig(t),r=parseFloat(t.at_least),o=parseInt(t.range_type,10),a=e._f("time")(t.start_time),u=e._f("time")(t.end_time),c=parseInt(t.range_type,10);return{$orig:i,m5:r,m6:o,f0:a,f1:u,m7:c}}));e.$mp.data=Object.assign({},{$root:{m0:n,m1:i,l0:r,m3:o,m4:a,l1:u}})},o=[]},eec4:function(e,t,n){"use strict";n.r(t);var i=n("a710"),r=n("2ed9");for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n("5049");var a,u=n("f0c5"),c=Object(u["a"])(r["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);t["default"]=c.exports}},[["0e61","common/runtime","common/vendor"]]]);