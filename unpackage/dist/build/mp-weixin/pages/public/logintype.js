(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/public/logintype"],{2261:function(e,t,n){"use strict";(function(e){n("3029"),n("921b");o(n("66fd"));var t=o(n("430f"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"25b0":function(e,t,n){"use strict";var o=n("554c"),r=n.n(o);r.a},"366a":function(e,t,n){"use strict";n.r(t);var o=n("bbf0"),r=n.n(o);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=r.a},"430f":function(e,t,n){"use strict";n.r(t);var o=n("69b7"),r=n("366a");for(var i in r)"default"!==i&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("25b0");var a,c=n("f0c5"),s=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=s.exports},"554c":function(e,t,n){},"69b7":function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}));var o={rfImage:function(){return Promise.all([n.e("common/vendor"),n.e("components/rf-image/rf-image")]).then(n.bind(null,"0e89"))}},r=function(){var e=this,t=e.$createElement;e._self._c},i=[]},bbf0:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("a34a")),r=n("f15c");function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n,o,r,i,a){try{var c=e[i](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(o,r)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function c(e){a(i,o,r,c,s,"next",e)}function s(e){a(i,o,r,c,s,"throw",e)}c(void 0)}))}}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){n.e("components/rf-protocol-popup/index").then(function(){return resolve(n("4cf5"))}.bind(null,n)).catch(n.oe)},g={components:{rfProtocolPopup:p},data:function(){return{btnLoading:!1,isRfProtocolPopupShow:!1,appAgreementDefaultSelect:this.$mSettingConfig.appAgreementDefaultSelect,isAuthLoginShow:!1,isIosAuthLoginShow:!1,logo:this.$mSettingConfig.appLogo,appName:this.$mSettingConfig.appName,promoCodeParams:{},styleLoginType:this.$mSettingConfig.styleLoginType,wechat:this.$mAssetsPath.wechat,apple:this.$mAssetsPath.apple,closeThirdPartyLogin:this.$mSettingConfig.closeThirdPartyLogin,loginTypeList:[{text:"微信",icon:"iconweixin"}]}},onShow:function(){this.btnLoading=!1,e.getStorageSync("accessToken")&&this.$mRouter.reLaunch({route:"/pages/index/index"})},onLoad:function(t){var n=this;this.$mStore.commit("logout"),this.isAuthLoginShow=!0,this.code=t.code&&t.code.split(",")[t.code.split(",").length-1],e.getStorageSync("notFirstTimeLogin")?this.appAgreementDefaultSelect=!0:this.appAgreementDefaultSelect||(this.appAgreementDefaultSelect=!1);var i=e.getStorageSync("backToPage");-1!==i.indexOf("promo_code")&&(this.promoCodeParams.promo_code=JSON.parse(i)["query"]["promo_code"]);var a=this;this.code&&(this.btnLoading=!0,this.$http.get(r.wechatH5Login,u({code:this.code},a.promoCodeParams)).then(function(){var t=c(o.default.mark((function t(r){var i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.btnLoading=!1,r.data.login){t.next=6;break}n.user_info=r.data.user_info.original,e.showModal({content:"您尚未绑定账号，是否跳转登录页面？",success:function(t){t.confirm?(e.setStorageSync("wechatUserInfo",JSON.stringify(a.user_info)),a.$mRouter.push({route:"/pages/public/login"})):n.btnLoading=!1}}),t.next=10;break;case 6:return t.next=8,n.$mStore.commit("login",r.data.user_info);case 8:i=e.getStorageSync("backToPage"),i?(-1!==i.indexOf("/pages/profile/profile")||-1!==i.indexOf("/pages/cart/cart")||-1!==i.indexOf("/pages/index/index")||-1!==i.indexOf("/pages/notify/notify")||-1!==i.indexOf("/pages/category/category")?n.$mRouter.reLaunch(JSON.parse(i)):n.$mRouter.redirectTo(JSON.parse(i)),e.removeStorageSync("backToPage"),e.removeStorageSync("wechatUserInfo")):n.$mRouter.reLaunch({route:"/pages/profile/profile"});case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(){n.btnLoading=!1})))},methods:{navTo:function(e){this.appAgreementDefaultSelect?this.$mRouter.redirectTo({route:e}):this.$mHelper.toast("请勾选并阅读协议，才能进行下一步哦",1500)},handleRfProtocolPopupShow:function(){this.isRfProtocolPopupShow=!0},popupState:function(t){t?(this.appAgreementDefaultSelect=!0,e.setStorageSync("notFirstTimeLogin",!0),this.isRfProtocolPopupShow=!1):(this.appAgreementDefaultSelect=!1,this.isRfProtocolPopupShow=!1)},toAuthLogin:function(){if(this.btnLoading=!0,!this.appAgreementDefaultSelect)return this.$mHelper.toast("请阅读并同意协议",1500),void(this.btnLoading=!1);var t,n=this;e.login({provider:"weixin",success:function(o){e.getUserInfo({provider:"weixin",success:function(e){var i=n.promoCodeParams;t=r.mpWechatLogin,i=u(u({},e),i),i.code=o.code,n.thirdPartyAuthLogin(t,i)},fail:function(){n.btnLoading=!1}})},fail:function(){n.btnLoading=!1,n.$mHelper.log("暂不支持小程序登录")}})},thirdPartyAuthLogin:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this;r.$http.post(t,n).then(function(){var t=c(o.default.mark((function t(n){var i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r.btnLoading=!1,n.data.login){t.next=6;break}r.user_info=n.data.user_info,e.showModal({content:"您尚未绑定账号，是否跳转登录页面？",success:function(t){t.confirm&&(e.setStorageSync("wechatUserInfo",JSON.stringify(r.user_info)),r.$mRouter.push({route:"/pages/public/login"}))}}),t.next=11;break;case 6:return t.next=8,r.$mStore.commit("login",n.data.user_info);case 8:r.$mHelper.toast("已为您授权登录"),i=e.getStorageSync("backToPage"),i?(-1!==i.indexOf("/pages/profile/profile")||-1!==i.indexOf("/pages/cart/cart")||-1!==i.indexOf("/pages/notify/notify")||-1!==i.indexOf("/pages/index/index")||-1!==i.indexOf("/pages/category/category")?r.$mRouter.reLaunch(JSON.parse(i)):r.$mRouter.redirectTo(JSON.parse(i)),e.removeStorageSync("backToPage"),e.removeStorageSync("wechatUserInfo")):r.$mRouter.reLaunch({route:"/pages/profile/profile"});case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(){r.btnLoading=!1}))},toIosAuthLogin:function(){if(this.btnLoading=!0,!this.appAgreementDefaultSelect)return this.$mHelper.toast("请阅读并同意协议",1500),void(this.btnLoading=!1);var t=this;plus.oauth.getServices((function(n){var i;if(n&&n.length){for(var a=0,s=n.length;a<s;a++)if("apple"===n[a].id){i=n[a];break}if(!i)return t.btnLoading=!1,void t.$mHelper.toast("没有苹果登录授权服务");i.login((function(n){t.$http.post(r.thirdPartyApple,u(u({},n.target.appleInfo),t.promoCodeParams)).then(function(){var n=c(o.default.mark((function n(r){var i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.btnLoading=!1,r.data.login){n.next=6;break}t.user_info=r.data.user_info,e.showModal({content:"您尚未绑定账号，是否跳转登录页面？",success:function(n){n.confirm&&(e.setStorageSync("wechatUserInfo",JSON.stringify(t.user_info)),e.setStorageSync("oauthClient","iOS"),t.$mRouter.push({route:"/pages/public/login"}))}}),n.next=11;break;case 6:return n.next=8,t.$mStore.commit("login",r.data.user_info);case 8:t.$mHelper.toast("已为您授权登录"),i=e.getStorageSync("backToPage"),i?(-1!==i.indexOf("/pages/profile/profile")||-1!==i.indexOf("/pages/cart/cart")||-1!==i.indexOf("/pages/notify/notify")||-1!==i.indexOf("/pages/index/index")||-1!==i.indexOf("/pages/category/category")?t.$mRouter.reLaunch(JSON.parse(i)):t.$mRouter.redirectTo(JSON.parse(i)),e.removeStorageSync("backToPage"),e.removeStorageSync("wechatUserInfo")):t.$mRouter.reLaunch({route:"/pages/profile/profile"});case 11:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()).catch((function(){t.btnLoading=!1}))}),(function(){t.btnLoading=!1}))}}),(function(){t.btnLoading=!1}))}}};t.default=g}).call(this,n("543d")["default"])}},[["2261","common/runtime","common/vendor"]]]);