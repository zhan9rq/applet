(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/public/login"],{"14f3":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r("a34a")),n=r("f15c"),a=i(r("9e6c"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e,t,r,o,n,a,i){try{var s=e[a](i),c=s.value}catch(u){return void r(u)}s.done?t(c):Promise.resolve(c).then(o,n)}function l(e){return function(){var t=this,r=arguments;return new Promise((function(o,n){var a=e.apply(t,r);function i(e){d(a,o,n,i,s,"next",e)}function s(e){d(a,o,n,i,s,"throw",e)}i(void 0)}))}}var m={data:function(){return{loginParams:{mobile:"",code:"",password:""},registerParams:{mobile:"",password:"",password_repetition:"",promoCode:"",nickname:"",code:""},btnLoading:!1,reqBody:{},codeSeconds:0,loginByPass:!0,smsCodeBtnDisabled:!0,userInfo:null,loginBg:this.$mAssetsPath.loginBg,loginPic:this.$mAssetsPath.loginPic,appName:this.$mSettingConfig.appName,styleLoginType:this.$mSettingConfig.styleLoginType,closeRegisterPromoCode:this.$mSettingConfig.closeRegisterPromoCode,tabCurrentIndex:0,typeList:[{text:"登录"},{text:"注册"}]}},onShow:function(){this.$mStore.getters.hasLogin&&this.$mRouter.reLaunch({route:"/pages/index/index"})},onLoad:function(t){this.tabCurrentIndex=parseInt(t.type||0,10);var r=(0,a.default)().valueOf()/1e3-e.getStorageSync("loginSmsCodeTime");r<60?(this.codeSeconds=this.$mConstDataConfig.sendCodeTime-parseInt(r,10),this.handleSmsCodeTime(this.codeSeconds)):(this.codeSeconds=this.$mConstDataConfig.sendCodeTime,this.smsCodeBtnDisabled=!1,e.removeStorageSync("loginSmsCodeTime")),this.registerParams.promoCode=t.promo_code,this.loginParams.mobile=e.getStorageSync("loginMobile")||"",this.loginParams.password=e.getStorageSync("loginPassword")||"",this.userInfo=e.getStorageSync("wechatUserInfo")},methods:{loginTest:function(e,t){this.loginParams.mobile=e,this.loginParams.password=t},getSmsCode:function(){var t=arguments,r=this;return l(o.default.mark((function i(){var s,c;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(s=t.length>0&&void 0!==t[0]?t[0]:"login",r.reqBody["mobile"]=0===r.tabCurrentIndex?r.loginParams["mobile"]:r.registerParams["mobile"],c=r.$mGraceChecker.check(r.reqBody,r.$mFormRule.sendCodeRule),c){o.next=6;break}return r.$mHelper.toast(r.$mGraceChecker.error),o.abrupt("return");case 6:return o.next=8,r.$http.post(n.smsCode,{mobile:r.reqBody["mobile"],usage:s}).then((function(t){t.data?r.$mHelper.toast("验证码发送成功, 验证码是".concat(t.data)):r.$mHelper.toast("验证码已发送."),r.smsCodeBtnDisabled=!0,e.setStorageSync("loginSmsCodeTime",(0,a.default)().valueOf()/1e3),r.handleSmsCodeTime(59)}));case 8:case"end":return o.stop()}}),i)})))()},handleSmsCodeTime:function(e){var t=this,r=setInterval((function(){0===e?(clearInterval(r),t.smsCodeBtnDisabled=!1):(t.codeSeconds=e,t.smsCodeBtnDisabled=!0,e--)}),1e3)},blurMobileChange:function(e){this.mobile=e.detail.value},showLoginBySmsCode:function(){this.loginByPass=!this.loginByPass},navBack:function(){this.$mRouter.back()},navTo:function(e){this.$mRouter.push({route:e})},toHome:function(){this.$mRouter.reLaunch({route:"/pages/index/index"})},toLogin:function(){var t=this;return l(o.default.mark((function r(){var a,i,s;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.$mSettingConfig.closeLogin){r.next=3;break}return t.$mHelper.toast("暂未开放登录，敬请期待～"),r.abrupt("return");case 3:if(e.removeStorageSync("loginMobile"),e.removeStorageSync("loginPassword"),t.reqBody["mobile"]=t.loginParams["mobile"],t.loginByPass?(i=n.loginByPass,t.reqBody["password"]=t.loginParams["password"],a=t.$mGraceChecker.check(t.reqBody,t.$mFormRule.loginByPassRule)):(t.reqBody["code"]=t.loginParams["code"],i=n.loginBySmsCode,a=t.$mGraceChecker.check(t.reqBody,t.$mFormRule.loginByCodeRule)),a){r.next=10;break}return t.$mHelper.toast(t.$mGraceChecker.error),r.abrupt("return");case 10:t.reqBody.group=t.$mHelper.platformGroupFilter(),s=e.getStorageSync("backToPage"),-1!==s.indexOf("promo_code")&&(t.reqBody.promo_code=JSON.parse(s)["query"]["promo_code"]),t.handleLogin(t.reqBody,i);case 14:case"end":return r.stop()}}),r)})))()},handleLogin:function(t,r){var a=this;return l(o.default.mark((function i(){return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return a.btnLoading=!0,o.next=3,a.$http.post(r,t).then((function(t){if(a.$mHelper.toast("恭喜您，登录成功！"),a.$mStore.commit("login",t.data),a.userInfo){a.btnLoading=!1;var r={oauth_client:"wechatMp"},o=JSON.parse(a.userInfo);a.$http.post(n.authLogin,c(c(c({},o),r),{},{gender:o.sex||o.gender,oauth_client_user_id:o.openid||o.openId,head_portrait:o.headimgurl||o.avatarUrl}))}e.removeStorageSync("wechatUserInfo");var i=e.getStorageSync("backToPage");e.removeStorageSync("backToPage"),i?-1!==i.indexOf("/pages/profile/profile")||-1!==i.indexOf("/pages/cart/cart")||-1!==i.indexOf("/pages/index/index")||-1!==i.indexOf("/pages/notify/notify")||-1!==i.indexOf("/pages/category/category")?a.$mRouter.reLaunch(JSON.parse(i)):a.$mRouter.redirectTo(JSON.parse(i)):a.$mRouter.reLaunch({route:"/pages/profile/profile"})})).catch((function(){a.btnLoading=!1}));case 3:case"end":return o.stop()}}),i)})))()},tabClick:function(e){this.tabCurrentIndex=e},toRegister:function(){var t=this;return l(o.default.mark((function r(){var a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!t.$mSettingConfig.closeRegister){r.next=3;break}return t.$mHelper.toast("暂未开放注册，敬请期待～"),r.abrupt("return");case 3:if(t.reqBody["mobile"]=t.registerParams["mobile"],t.reqBody["password"]=t.registerParams["password"],t.reqBody["code"]=t.registerParams["code"],t.reqBody["nickname"]=t.registerParams["nickname"],a=t.$mGraceChecker.check(t.reqBody,t.$mFormRule.registerRule),a){r.next=11;break}return t.$mHelper.toast(t.$mGraceChecker.error),r.abrupt("return");case 11:if(t.registerParams["password"]===t.registerParams["password_repetition"]){r.next=14;break}return t.$mHelper.toast("两次输入的密码不一致"),r.abrupt("return");case 14:return t.reqBody["password_repetition"]=t.registerParams["password_repetition"],t.reqBody["promo_code"]=t.registerParams["promoCode"],t.btnLoading=!0,t.reqBody.group=t.$mHelper.platformGroupFilter(),r.next=20,t.$http.post(n.registerByPass,t.reqBody).then((function(){t.btnLoading=!1,t.$mHelper.toast("恭喜您注册成功"),e.setStorageSync("loginMobile",t.reqBody["mobile"]),e.setStorageSync("loginPassword",t.reqBody["password"]),t.$mRouter.push({route:"/pages/public/login"})})).catch((function(){t.btnLoading=!1}));case 20:case"end":return r.stop()}}),r)})))()}}};t.default=m}).call(this,r("543d")["default"])},4633:function(e,t,r){},"87b2":function(e,t,r){"use strict";r.r(t);var o=r("14f3"),n=r.n(o);for(var a in o)"default"!==a&&function(e){r.d(t,e,(function(){return o[e]}))}(a);t["default"]=n.a},"8d65":function(e,t,r){"use strict";r.r(t);var o=r("df4a"),n=r("87b2");for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);r("b52b");var i,s=r("f0c5"),c=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],i);t["default"]=c.exports},b52b:function(e,t,r){"use strict";var o=r("4633"),n=r.n(o);n.a},dee6:function(e,t,r){"use strict";(function(e){r("3029"),r("921b");o(r("66fd"));var t=o(r("8d65"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},df4a:function(e,t,r){"use strict";var o;r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return o}));var n=function(){var e=this,t=e.$createElement;e._self._c},a=[]}},[["dee6","common/runtime","common/vendor"]]]);